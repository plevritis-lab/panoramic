% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/panoramic-visualization.R
\name{plot_volcano}
\alias{plot_volcano}
\title{Volcano plot for differential spatial colocalization}
\usage{
plot_volcano(
  se_diff,
  fdr_threshold = 0.05,
  effect_threshold = 5,
  label_top = NULL,
  title = NULL
)
}
\arguments{
\item{se_diff}{A SummarizedExperiment returned by
\code{pano_compare_groups()}, where rowData(se_diff) contains at least
ct1, ct2, beta_diff, p_diff, and fdr_diff.}

\item{fdr_threshold}{Numeric scalar. FDR threshold used to define
significance for highlighting and labeling. Default is 0.05.}

\item{effect_threshold}{Numeric scalar. Absolute effect size threshold
|beta| used to highlight strong effects. Default is 5.}

\item{label_top}{Optional integer. If non-NULL, only the top
label_top pairs (smallest p_diff) among FDR-significant
features are labeled. If NULL (default), all FDR-significant
pairs are labeled.}

\item{title}{Optional character string for a custom plot title. If
NULL, a title is constructed from metadata(se_diff)$panoramic
if available.}
}
\value{
A ggplot object representing the volcano plot.
}
\description{
Create a volcano plot summarizing differential spatial colocalization
results from PANORAMIC. Points represent cell-type pairs, with the
x-axis showing effect sizes and the y-axis showing -log10(p)
from \code{p_diff}. Significant pairs can be highlighted and labeled.
}
\examples{
library(SpatialExperiment)
library(S4Vectors)
library(BiocParallel)

set.seed(1)

make_spe <- function(n_cells, sample_id, group_label, bias_to_A = FALSE) {
  coords <- cbind(
    x = runif(n_cells, 0, 100),
    y = runif(n_cells, 0, 100)
  )

  # Control: roughly equal A/B; Case: bias toward A within same window
  if (bias_to_A) {
    ct <- ifelse(coords[, 1] > 30 & coords[, 1] < 70 &
                   coords[, 2] > 30 & coords[, 2] < 70,
                 "A", sample(c("A", "B"), size = n_cells, replace = TRUE))
  } else {
    ct <- sample(c("A", "B"), size = n_cells, replace = TRUE)
  }

  counts <- matrix(
    rpois(5 * n_cells, lambda = 5),
    nrow = 5,
    dimnames = list(
      paste0("gene", seq_len(5)),
      paste0(sample_id, "_cell", seq_len(n_cells))
    )
  )

  SpatialExperiment::SpatialExperiment(
    assays = list(counts = counts),
    colData = S4Vectors::DataFrame(
      cell_type = ct,
      sample_id = sample_id,
      group     = group_label
    ),
    spatialCoords = coords
  )
}

# 3 control and 3 case samples -----------------------------------------
spe_list <- list(
  sample1 = make_spe(80, "sample1", "control", bias_to_A = FALSE),
  sample2 = make_spe(80, "sample2", "control", bias_to_A = FALSE),
  sample3 = make_spe(80, "sample3", "control", bias_to_A = FALSE),
  sample4 = make_spe(80, "sample4", "case",    bias_to_A = TRUE),
  sample5 = make_spe(80, "sample5", "case",    bias_to_A = TRUE),
  sample6 = make_spe(80, "sample6", "case",    bias_to_A = TRUE)
)

design <- data.frame(
  sample = paste0("sample", 1:6),
  group  = c(rep("control", 3), rep("case", 3)),
  stringsAsFactors = FALSE
)

se_stats <- panoramic(
  spe_list,
  design      = design,
  cell_type   = "cell_type",
  radii_um    = 10,
  stat        = "Lcross",
  nsim        = 10,
  correction  = "translate",
  min_cells   = 5,
  concavity   = 50,
  window      = "rect",
  seed        = 1,
  BPPARAM     = BiocParallel::SerialParam()
)

se_meta <- panoramic_meta(se_stats, tau2 = "SJ", group_col = "group")
se_diff <- panoramic_compare_groups(se_meta, group1 = "control", group2 = "case")

# Check that we have usable differential results
summary(is.na(rowData(se_diff)$beta_diff))
summary(is.na(rowData(se_diff)$p_diff))

# Example: volcano plot (requires ggrepel)
if (requireNamespace("ggrepel", quietly = TRUE)) {
  p_vol <- plot_volcano(
    se_diff,
    fdr_threshold    = 1,
    effect_threshold = 0.5,
    label_top        = 5
  )
  print(p_vol)
}
}
