% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/panoramic-spatialstats.R
\name{panoramic_spatialstats}
\alias{panoramic_spatialstats}
\title{Compute pairwise spatial statistics for PANORAMIC}
\usage{
panoramic_spatialstats(
  prep,
  pairs = "auto",
  radii_um,
  stat = "Lcross",
  nsim = 100,
  correction = "translate",
  keep_boot = FALSE,
  seed = 123,
  BPPARAM = BiocParallel::SerialParam()
)
}
\arguments{
\item{prep}{List of prepared SpatialExperiment objects as returned by \code{panoramic_prepare()},
each with \code{metadata(spe)$panoramic}.}

\item{pairs}{Either "auto" (generate all cell-type pairs including self-pairs)
or a data.frame with columns \code{ct1}, \code{ct2}.}

\item{radii_um}{Numeric vector of radii (microns) at which to evaluate the colocalization statistic.}

\item{stat}{Character. Summary statistic ("Lcross", "Lest", "Kcross", "Kest").}

\item{nsim}{Integer. Number of Loh bootstrap simulations per sample/pair.}

\item{correction}{Chatacter. Edge correction method for spatstat ("translate", "border", ...).}

\item{keep_boot}{Logical. Reserved for future use (keeping full bootstrap objects).}

\item{seed}{Integer random seed for reproducible bootstrap simulations.}

\item{BPPARAM}{A BiocParallelParam object controlling parallelisation across samples.}
}
\value{
A SummarizedExperiment with :
\itemize{
\item assay "yi": centered estimates per (ct1, ct2, radius) feature and sample.
\item assay "vi": variance estimates aligned to "yi".
}
rowData stores \code{ct1}, \code{ct2}, \code{radius_um}, \code{stat}
colData stores \code{sample} and \code{group}.
}
\description{
Compute pairwise spatial summary curves (e.g. Lcross) and bootstrap
variances for all requested cell-type pairs and radii across multiple
prepared samples, returning a SummarizedExperiment.
}
\examples{
library(SpatialExperiment)
library(S4Vectors)
library(BiocParallel)

set.seed(1)

make_spe <- function(n_cells, sample_id) {
  coords <- cbind(
    x = runif(n_cells, 0, 100),
    y = runif(n_cells, 0, 100)
  )
  ct <- sample(c("A", "B"), size = n_cells, replace = TRUE)

  counts <- matrix(
    rpois(5 * n_cells, lambda = 5),
    nrow = 5,
    dimnames = list(
      paste0("gene", seq_len(5)),
      paste0(sample_id, "_cell", seq_len(n_cells))
    )
  )

  SpatialExperiment::SpatialExperiment(
    assays = list(counts = counts),
    colData = S4Vectors::DataFrame(
      cell_type = ct,
      sample_id = sample_id
    ),
    spatialCoords = coords
  )
}

spe1 <- make_spe(20, "sample1")
spe2 <- make_spe(22, "sample2")

spe_list <- list(sample1 = spe1, sample2 = spe2)

design <- data.frame(
  sample = c("sample1", "sample2"),
  group  = c("group1", "group1"),
  stringsAsFactors = FALSE
)

# Prepare inputs for PANORAMIC
prep <- panoramic_prepare(
  spe_list,
  design      = design,
  cell_type   = "cell_type",
  min_cells   = 2,
  window      = "rect",
  BPPARAM     = BiocParallel::SerialParam()
)

# Compute spatial statistics across samples
se_stats <- panoramic_spatialstats(
  prep      = prep,
  pairs     = "auto",
  radii_um  = c(10, 20),
  stat      = "Lcross",
  nsim      = 5,
  correction = "translate",
  seed      = 1,
  BPPARAM   = BiocParallel::SerialParam()
)

se_stats
}
